<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Internet Museum</title>
  <style>
    /* === ÙƒÙ„ ØªÙ†Ø³ÙŠÙ‚Ø§ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ === */
    :root {
      --primary-color: #0f0;
      --secondary-color: #ff00ff;
      --bg-color: #000;
      --card-bg: #111;
      --text-color: #0f0;
      --accent-color: #00ffff;
    }
    * { box-sizing: border-box; }
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(0, 255, 0, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 0, 255, 0.05) 0%, transparent 20%);
    }
    /* ... (ÙƒÙ„ CSS Ø§Ù„Ø£ØµÙ„ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ) ... */

    /* âœ… ØªØµÙ…ÙŠÙ… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± */
    #liveVisitors {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #111;
      padding: 10px 15px;
      border: 1px solid #0f0;
      border-radius: 6px;
      color: #0f0;
      font-family: 'Courier New', monospace;
      box-shadow: 0 0 10px rgba(0,255,0,0.4);
      z-index: 9999;
    }
  </style>
</head>
<body>

<!-- Ø¥Ø¹Ù„Ø§Ù† SonLLC -->
<div class="ad-container" id="sonllcAd">
  <button class="close-ad" id="closeAd">Ã—</button>
  <div class="ad-banner">
    <div class="ad-text">Sponsored by SonLLC</div>
    <button class="ad-button" id="visitBtn">Visit SonLLC</button>
  </div>
</div>

<header>
  <h1>Random Internet Museum</h1>
  <div class="subtitle">A nostalgic journey through digital history</div>
</header>

<div id="museum">
  <div class="museum-item">
    <div class="loading">Loading museum artifacts...</div>
  </div>
</div>

<div class="controls">
  <button id="prevBtn">Previous</button>
  <button id="nextBtn">Next</button>
  <button id="autoBtn">Auto Play</button>
  <button id="infoBtn">Info</button>
</div>

<div class="progress-bar">
  <div class="progress" id="progress"></div>
</div>

<footer>
  BY <a href="https://x.com/2mzya" class="footer-link" target="_blank">Mohamad Zahir</a> & Mohammed Osama
</footer>

<!-- âœ… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ† -->
<div id="liveVisitors">ğŸ‘¥ Live Visitors: <span id="visitorCount">Loading...</span></div>

<script src="museum-data.js"></script>
<script>
  /* === ÙƒÙ„ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ === */
  const museumDiv = document.getElementById('museum');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  const autoBtn = document.getElementById('autoBtn');
  const infoBtn = document.getElementById('infoBtn');
  const visitBtn = document.getElementById('visitBtn');
  const progressBar = document.getElementById('progress');
  const closeAd = document.getElementById('closeAd');
  const sonllcAd = document.getElementById('sonllcAd');
  let data = [];
  let currentIndex = 0;
  let autoPlayInterval = null;
  let autoPlaySpeed = 5000;

  /* ... (Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ­Ù ÙƒÙ…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡) ... */
</script>

<!-- âœ… ÙƒÙˆØ¯ Firebase Ø§Ù„Ù…Ø¯Ù…Ø¬ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { 
    getDatabase, ref, onValue, onDisconnect, set, get, serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBstw5bNuq7u6ahJzN94fsRxcLIGNVGk0U",
    authDomain: "livevisitors2025.firebaseapp.com",
    databaseURL: "https://livevisitors2025-default-rtdb.firebaseio.com",
    projectId: "livevisitors2025",
    storageBucket: "livevisitors2025.firebasestorage.app",
    messagingSenderId: "550260737631",
    appId: "1:550260737631:web:d2cc207825df792c057dea",
    measurementId: "G-K027GT40V1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ğŸ‘¥ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†
  const visitorsRef = ref(db, "activeVisitors");
  const sessionId = sessionStorage.getItem("sessionId") || Math.random().toString(36).substring(2);
  sessionStorage.setItem("sessionId", sessionId);
  const myRef = ref(db, "activeVisitors/" + sessionId);

  set(myRef, { joined: serverTimestamp() });
  onDisconnect(myRef).remove();

  onValue(visitorsRef, (snapshot) => {
    const data = snapshot.val() || {};
    const count = Object.keys(data).length;
    document.getElementById("visitorCount").textContent = count;
  });

  // ğŸ“Š ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©
  async function recordVisitOncePerSession() {
    if (sessionStorage.getItem("visitRecorded")) return;
    const now = new Date();
    const dateKey = now.toISOString().split('T')[0];
    const year = now.getFullYear();
    const monthKey = `${year}-${String(now.getMonth() + 1).padStart(2, '0')}`;
    const weekNumber = Math.ceil(((now - new Date(year, 0, 1)) / 86400000 + new Date(year, 0, 1).getDay() + 1) / 7);
    const weekKey = `${year}-W${String(weekNumber).padStart(2, '0')}`;

    async function incrementCounter(path) {
      const refPath = ref(db, path);
      const snapshot = await get(refPath);
      const current = snapshot.exists() ? snapshot.val() : 0;
      await set(refPath, current + 1);
    }

    await incrementCounter(`stats/daily/${dateKey}`);
    await incrementCounter(`stats/weekly/${weekKey}`);
    await incrementCounter(`stats/monthly/${monthKey}`);

    sessionStorage.setItem("visitRecorded", "true");
  }

  recordVisitOncePerSession();
</script>

</body>
</html>
